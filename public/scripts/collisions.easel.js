this.collision=this.collision||{};(function(){var e=document.createElement("canvas");var t=e.getContext("2d");t.save();var n=document.createElement("canvas");var r=n.getContext("2d");r.save();var i=[];var s=function(e,t){var n,r;n=h(e);r=h(t);return c(n,r)};collision.checkRectCollision=s;var o=function(i,o,l,c){if(collision.DEBUG||collision.DEBUG_COLLISION){document.body.appendChild(e);document.body.appendChild(n)}c=c||false;var h,p,d,v,m;h=u(i,o);if(!h){return false}p=s(i,o);if(!p){return false}l=l||0;l=Math.min(.99999,l);e.width=p.width;e.height=p.height;n.width=p.width;n.height=p.height;d=a(p,i,t,1);v=a(p,o,r,2);m=f(d,v,p.width,p.height,l,c);if(m){m.x+=p.x;m.x2+=p.x;m.y+=p.y;m.y2+=p.y}else{return false}return m};collision.checkPixelCollision=o;var u=function(e,t){var n,r,i,s;i=e.localToGlobal(0,0);s=t.localToGlobal(0,0);n=e instanceof createjs.Bitmap?{width:e.image.width,height:e.image.height}:e.spriteSheet.getFrame(e.currentFrame).rect;r=t instanceof createjs.Bitmap?{width:t.image.width,height:t.image.height}:t.spriteSheet.getFrame(t.currentFrame).rect;return Math.abs(s.x-i.x)<r.width*t.scaleX+n.width*e.scaleX&&Math.abs(s.y-i.y)<r.height*t.scaleY+n.height*t.scaleY};var a=function(e,t,n,r){var s,o,u;if(t instanceof createjs.Bitmap){o=t.image}else if(t instanceof createjs.BitmapAnimation){u=t.currentFrame+t.spriteSheet.getFrame(t.currentFrame).image.src;if(i[u]){o=i[u]}else{i[u]=o=createjs.SpriteSheetUtils.extractFrame(t.spriteSheet,t.currentFrame)}}s=t.globalToLocal(e.x,e.y);n.restore();n.clearRect(0,0,e.width,e.height);n.rotate(l(t,"rotation")*(Math.PI/180));n.scale(l(t,"scaleX","*"),l(t,"scaleY","*"));n.translate(-s.x-e["rect"+r].regX,-s.y-e["rect"+r].regY);n.drawImage(o,0,0,o.width,o.height);return n.getImageData(0,0,e.width,e.height).data};var f=function(e,t,n,r,i,s){var o,u,a,f,l=3,c={x:Infinity,y:Infinity,x2:-Infinity,y2:-Infinity};for(f=0;f<r;++f){for(a=0;a<n;++a){o=e.length>l+1?e[l]/255:0;u=t.length>l+1?t[l]/255:0;if(o>i&&u>i){if(s){if(a<c.x)c.x=a;if(a>c.x2)c.x2=a;if(f<c.y)c.y=f;if(f>c.y2)c.y2=f}else{return{x:a,y:f,width:1,height:1}}}l+=4}}if(c.x!=Infinity){c.width=c.x2-c.x+1;c.height=c.y2-c.y+1;return c}return null};var l=function(e,t,n){n=n||"+";if(e.parent&&e.parent[t]){var r=e[t];var i=l(e.parent,t,n);if(n=="*"){return r*i}else{return r+i}}return e[t]};var c=function(e,t){var n,r,i={},s={};i.cx=e.x+(i.hw=e.width/2);i.cy=e.y+(i.hh=e.height/2);s.cx=t.x+(s.hw=t.width/2);s.cy=t.y+(s.hh=t.height/2);n=Math.abs(i.cx-s.cx)-(i.hw+s.hw);r=Math.abs(i.cy-s.cy)-(i.hh+s.hh);if(n<0&&r<0){n=Math.min(Math.min(e.width,t.width),-n);r=Math.min(Math.min(e.height,t.height),-r);return{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y),width:n,height:r,rect1:e,rect2:t}}else{return null}};collision.calculateIntersection=c;var h=function(e){var t={x:Infinity,y:Infinity,width:0,height:0};if(e instanceof createjs.Container){t.x2=-Infinity;t.y2=-Infinity;var n=e.children,r=n.length,i,s;for(s=0;s<r;s++){i=h(n[s]);if(i.x<t.x)t.x=i.x;if(i.y<t.y)t.y=i.y;if(i.x+i.width>t.x2)t.x2=i.x+i.width;if(i.y+i.height>t.y2)t.y2=i.y+i.height}if(t.x==Infinity)t.x=0;if(t.y==Infinity)t.y=0;if(t.x2==Infinity)t.x2=0;if(t.y2==Infinity)t.y2=0;t.width=t.x2-t.x;t.height=t.y2-t.y;delete t.x2;delete t.y2}else{var o,u,a,f,l;if(e instanceof createjs.Bitmap){l=e.image}else if(e instanceof createjs.BitmapAnimation){if(e.spriteSheet._frames&&e.spriteSheet._frames[e.currentFrame]&&e.spriteSheet._frames[e.currentFrame].image){var c=e.spriteSheet.getFrame(e.currentFrame);l=c.rect;l.regX=c.regX;l.regY=c.regY}else{l={};t.x=e.x||0;t.y=e.y||0}}else{l={};t.x=e.x||0;t.y=e.y||0}l.regX=l.regX||0;l.width=l.width||0;l.regY=l.regY||0;l.height=l.height||0;t.regX=l.regX;t.regY=l.regY;o=e.localToGlobal(0-l.regX,0-l.regY);u=e.localToGlobal(l.width-l.regX,l.height-l.regY);a=e.localToGlobal(l.width-l.regX,0-l.regY);f=e.localToGlobal(0-l.regX,l.height-l.regY);t.x=Math.min(Math.min(Math.min(o.x,u.x),a.x),f.x);t.y=Math.min(Math.min(Math.min(o.y,u.y),a.y),f.y);t.width=Math.max(Math.max(Math.max(o.x,u.x),a.x),f.x)-t.x;t.height=Math.max(Math.max(Math.max(o.y,u.y),a.y),f.y)-t.y}return t};collision.getBounds=h})()